package DAO;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;


public class DBMan {
	private Connection cn = null;

	DBMan()
	{
		try {
			// postgreSQLへの接続　以下の項目を自分の環境に合わせて変更
			Class.forName("org.postgresql.Driver");
			String url = "jdbc:postgresql://localhost:5432/testdb";
			String id  = "testuser";
			String psw = "testpass";
			cn = DriverManager.getConnection(url, id, psw);

		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		} catch (SQLException e) {
			// JOptionPane.showMessageDialog(null, "データベースの接続に失敗しました。");
			ErrorHandler.showErrorMessage(ErrorHandler.DATABASE_CONN_FAIL);
		}

	}

	public void Close() {
		try {
			cn.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}

	}

	public void SetAutoCommit( boolean bAutoCommit ) {
		try {
			cn.setAutoCommit(bAutoCommit);
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	public void Commit() {
		try {
			cn.commit();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	public void RollBack() {
		try {
			cn.rollback();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	public ResultSet execSQL( String sql ) {
		ResultSet rset = null;
		try {
			Statement stmt = cn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);
			rset = stmt.executeQuery(sql);
		} catch (SQLException e) {
			ErrorHandler.showErrorMessage(ErrorHandler.DATABASE_ERROR);
			// e.printStackTrace();
		}
		return rset;

	}

	public int updateSQL( String sql ) {
		int rcnt = 0;
		try {
			Statement stmt = cn.createStatement();
			rcnt = stmt.executeUpdate(sql);
		} catch (SQLException e) {
			ErrorHandler.showErrorMessage(ErrorHandler.DATABASE_ERROR);
		}
		return rcnt;

	}

}